import"../chunks/NZTpNUN0.js";import{i as da}from"../chunks/TJkHQNMV.js";import{b as _a,l as xa,e as V,s as Y,r as Sa,o as wa,w as ia}from"../chunks/Bcty0cuv.js";import{w as j,aA as ya,aB as Ca,aC as Ma,aD as $a,b as s,K as ka,p as J,aE as va,aF as fa,l as q,j as ga,k as L,m as Q,g as T,N as ua,P as O,q as x,t as W,Z as ha,n as w,o as y,a9 as sa}from"../chunks/Bly0QPQn.js";import{p as pa,b as Ia,i as aa,s as ea,a as X,c as p}from"../chunks/BrNDmNSV.js";const na=[...` 	
\r\fÂ \v\uFEFF`];function Pa(e,n,f){var d=""+e;if(f){for(var a in f)if(f[a])d=d?d+" "+a:a;else if(d.length)for(var r=a.length,l=0;(l=d.indexOf(a,l))>=0;){var g=l+r;(l===0||na.includes(d[l-1]))&&(g===d.length||na.includes(d[g]))?d=(l===0?"":d.substring(0,l))+d.substring(g+1):l=g}}return d===""?null:d}function Da(e,n,f,d,a,r){var l=e.__className;if(j||l!==f||l===void 0){var g=Pa(f,d,r);(!j||g!==e.getAttribute("class"))&&(g==null?e.removeAttribute("class"):e.className=g),e.__className=f}else if(r&&a!==r)for(var m in r){var C=!!r[m];(a==null||C!==!!a[m])&&e.classList.toggle(m,C)}return r}const Aa=Symbol("is custom element"),Na=Symbol("is html");function la(e){if(j){var n=!1,f=()=>{if(!n){if(n=!0,e.hasAttribute("value")){var d=e.value;oa(e,"value",null),e.value=d}if(e.hasAttribute("checked")){var a=e.checked;oa(e,"checked",null),e.checked=a}}};e.__on_r=f,ya(f),_a()}}function oa(e,n,f,d){var a=Ta(e);j&&(a[n]=e.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&e.nodeName==="LINK")||a[n]!==(a[n]=f)&&(n==="loading"&&(e[Ca]=f),e.removeAttribute(n))}function Ta(e){return e.__attributes??={[Aa]:e.nodeName.includes("-"),[Na]:e.namespaceURI===Ma}}function U(e,n,f=n){var d=$a();xa(e,"input",a=>{var r=a?e.defaultValue:e.value;if(r=H(e)?K(r):r,f(r),d&&r!==(r=n())){var l=e.selectionStart,g=e.selectionEnd;e.value=r??"",g!==null&&(e.selectionStart=l,e.selectionEnd=Math.min(g,e.value.length))}}),(j&&e.defaultValue!==e.value||s(n)==null&&e.value)&&f(H(e)?K(e.value):e.value),ka(()=>{var a=n();H(e)&&a===K(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function H(e){var n=e.type;return n==="number"||n==="range"}function K(e){return e===""?null:+e}var Ea=q('<canvas class="m-auto block h-[200px] w-[200px] bg-white" width="200" height="200"></canvas> <!>',1);function La(e,n){J(n,!1);const[f,d]=ea(),a=()=>X(r(),"$stickData",f);let r=pa(n,"stickData",8),l=ua();function g(b){if(!T(l))return;const i=T(l).getContext("2d");if(!i)return;const M=T(l).width,$=M/2,S=M/2,u=M/2*.9;i.clearRect(0,0,M,M),i.fillStyle="#9e9d9d",i.fillRect($-u,S-u,u*2,u*2);const k=b.calibCurve.map((h,N)=>{const t=N*(360/b.calibCurve.length)*Math.PI/180,c=h/100*u;return{x:$+Math.cos(-t)*c,y:S+Math.sin(-t)*c}});k.forEach(h=>{i.beginPath(),i.arc(h.x,h.y,3,0,2*Math.PI),i.fillStyle=h===k[0]?"#f55":"#4366da",i.fill(),i.closePath()});const D=b.deadZone;i.setLineDash([]),i.fillStyle="rgba(100,100,100,0.3)",i.beginPath(),k.forEach((h,N)=>{const t=$+(h.x-$)*D,c=S+(h.y-S)*D;N===0?i.moveTo(t,c):i.lineTo(t,c)}),i.closePath(),i.fill(),i.strokeStyle="#f55",i.lineWidth=2;const P=b.gateSize*u;i.beginPath();for(let h=0;h<8;h++){const N=h*45*Math.PI/180,t=$+Math.cos(N)*P,c=S+Math.sin(N)*P;h===0?i.moveTo(t,c):i.lineTo(t,c)}i.closePath(),i.stroke();const z=b.rawX,I=b.rawY,A=Math.hypot(z,I),v=Math.atan2(I,z),o=$+Math.cos(v)*A*u,R=S+Math.sin(v)*A*u;i.fillStyle="#5f5",i.beginPath(),i.arc(o,R,5,0,2*Math.PI),i.fill();let E=Math.max(0,A-D)/(1-D);E=Math.min(E,1);const F=$+Math.cos(v)*E*P,B=S+Math.sin(v)*E*P;i.fillStyle="#f55",i.beginPath(),i.arc(F,B,5,0,2*Math.PI),i.fill()}va(()=>(T(l),a()),()=>{T(l)&&g(a())}),fa();var m=Ea(),C=ga(m);Ia(C,b=>O(l,b),()=>T(l));var Z=x(C,2);aa(Z,b=>{}),L(e,m),Q(),d()}var za=q('<h3> </h3> <div><button><!></button></div> <label class="svelte-1bph924"> <input type="range" min="0" max="0.5" step="0.01" class="svelte-1bph924"/></label> <label class="svelte-1bph924"> <input type="range" min="0" max="1" step="0.0001" class="svelte-1bph924"/></label> <label class="svelte-1bph924">Calibration values: <textarea class="svelte-1bph924"></textarea></label> <button class="svelte-1bph924">Update</button> <!>',1);function ca(e,n){J(n,!1);const[f,d]=ea(),a=()=>X(r(),"$stickData",f);let r=pa(n,"stickData",8);function l(t,c=16){const _=Array(c).fill(0);for(const{x:G,y:ta}of t){const ma=Math.hypot(G,ta),ba=(Math.atan2(ta,G)*180/Math.PI+360)%360,ra=Math.floor(ba/(360/c))%c;_[ra]=Math.max(_[ra],ma)}return _}function g(t){const c=(t[0]+t[4]+t[8]+t[12])/4;return c===0?t.map(()=>100):t.map(_=>(_/c*100).toFixed(2))}let m=!1;function C(t){const c=navigator.getGamepads()[t];if(c){const[_,G]=[c.axes[a().axes[0]],c.axes[a().axes[1]]];p(r(),s(a).rawX=_,s(a)),p(r(),s(a).rawY=G,s(a)),a().calibrating&&(a().samples.push({x:_,y:G}),p(r(),s(a).calibCurve=g(l(a().samples,32)),s(a)),a().calibCurve.reverse(),p(r(),s(a).calibString=a().calibCurve.join(" "),s(a)))}requestAnimationFrame(()=>C(t))}const Z=t=>{!m&&t>-1&&(console.log(`Starting gamepad polling for stick: ${a().id} at index ${t}`),m=!0,C(t))};function b(t){if(a().calibrating)return;const c=t.trim().split(/\s+/).map(_=>parseFloat(_)).filter(_=>!isNaN(_));c.length>2&&p(r(),s(a).calibCurve=c,s(a))}va(()=>a(),()=>{Z(a().gamepadIndex)}),fa(),da();var i=za(),M=ga(i),$=w(M,!0);y(M);var S=x(M,2),u=w(S);let k;var D=w(u);{var P=t=>{var c=sa("Stop Calibration");L(t,c)},z=t=>{var c=sa("Start Calibration");L(t,c)};aa(D,t=>{a(),s(()=>a().calibrating)?t(P):t(z,!1)})}y(u),y(S);var I=x(S,2),A=w(I),v=x(A);la(v),y(I);var o=x(I,2),R=w(o),E=x(R);la(E),y(o);var F=x(o,2),B=x(w(F));Sa(B),y(F);var h=x(F,2),N=x(h,2);La(N,{get stickData(){return r()}}),W((t,c,_)=>{Y($,(a(),s(()=>a().id))),u.disabled=(a(),s(()=>a().gamepadIndex<0)),k=Da(u,1,"rounded bg-gray-300 px-1 svelte-1bph924",null,k,t),Y(A,`Dead Zone: ${c??""}% `),Y(R,`Gate Size: ${_??""}% `)},[()=>({"bg-green-300":a().gamepadIndex>-1&&!a().calibrating,"bg-red-500":a().gamepadIndex>-1&&a().calibrating}),()=>(a(),s(()=>(a().deadZone*100).toFixed(0))),()=>(a(),s(()=>(a().gateSize*100).toFixed(2)))],ha),V("click",u,()=>{p(r(),s(a).calibrating=!a().calibrating,s(a)),a().calibrating&&p(r(),s(a).samples=[],s(a))}),U(v,()=>a().deadZone,t=>p(r(),s(a).deadZone=t,s(a))),U(E,()=>a().gateSize,t=>p(r(),s(a).gateSize=t,s(a))),U(B,()=>a().calibString,t=>p(r(),s(a).calibString=t,s(a))),V("click",h,()=>b(a().calibString)),L(e,i),Q(),d()}var Ra=q("<div> </div>"),Za=q('<div class="text-red-500">Press a button or move a stick on your controller to detect it.</div>'),Fa=q(`<div class="p-[30px]"><div class="top svelte-13o7gew"><h1 class="svelte-13o7gew">Stick Calibration</h1> <!></div> <div class="container svelte-13o7gew"><div class="stick-panel svelte-13o7gew"><!></div> <div class="stick-panel svelte-13o7gew"><!></div></div> <p class="mt-2">Add the config below to your Dolphin controller profile. You can use the default one, usually
		found in:</p> <p class="code svelte-13o7gew">/storage/emulated/0/Android/data/org.dolphinemu.dolphinemu/files/Config/GCPadNew.ini</p> <p>or any custom profile inside:</p> <p class="code svelte-13o7gew">/storage/emulated/0/Android/data/org.dolphinemu.dolphinemu/files/Config/Profiles/GCPad/</p> <div class="mt-8">Config (click to copy):</div> <div class=" cursor-pointer bg-gray-300 p-[5px] font-mono whitespace-pre"> </div></div>`);function Oa(e,n){J(n,!1);const[f,d]=ea(),a=()=>X(g,"$left",f),r=()=>X(m,"$right",f);let l=ua("");const g=ia({calibrating:!1,gamepadIndex:-1,id:"Main Stick",rawX:0,rawY:0,deadZone:.1,gateSize:.7937,calibCurve:[],calibString:"",samples:[],axes:[0,1]}),m=ia({calibrating:!1,gamepadIndex:-1,id:"C-Stick",rawX:0,rawY:0,deadZone:.1,gateSize:.7221,calibCurve:[],calibString:"",samples:[],axes:[2,3]});wa(()=>{const v=navigator.getGamepads();for(let o=0;o<v.length;o++)if(v[o]){p(g,s(a).gamepadIndex=p(m,s(r).gamepadIndex=o,s(r)),s(a)),O(l,v[o].id);break}window.addEventListener("gamepadconnected",o=>{p(g,s(a).gamepadIndex=p(m,s(r).gamepadIndex=o.gamepad.index,s(r)),s(a)),O(l,o.gamepad.id)}),window.addEventListener("gamepaddisconnected",o=>{O(l,""),p(g,s(a).gamepadIndex=p(m,s(r).gamepadIndex=-1,s(r)),s(a))})});const C=v=>v.map(o=>[`${o.id}/Calibration = ${o.calibString}`,`${o.id}/Dead Zone = ${(o.deadZone*100).toFixed(2)}`,`${o.id}/Gate Size = ${(o.gateSize*100).toFixed(2)}`].join(`
`)).join(`
`),Z=v=>{navigator.clipboard.writeText(v)};da();var b=Fa(),i=w(b),M=x(w(i),2);{var $=v=>{var o=Ra(),R=w(o);y(o),W(()=>Y(R,`Controller: ${T(l)??""}`)),L(v,o)},S=v=>{var o=Za();L(v,o)};aa(M,v=>{T(l).length?v($):v(S,!1)})}y(i);var u=x(i,2),k=w(u),D=w(k);ca(D,{get stickData(){return g}}),y(k);var P=x(k,2),z=w(P);ca(z,{get stickData(){return m}}),y(P),y(u);var I=x(u,12),A=w(I,!0);y(I),y(b),W(v=>Y(A,v),[()=>C([a(),r()])],ha),V("click",I,()=>Z(C([a(),r()]))),L(e,b),Q(),d()}export{Oa as component};
