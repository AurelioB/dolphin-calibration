import"../chunks/NZTpNUN0.js";import{i as oa}from"../chunks/BcpuXKRR.js";import{b as pa,l as _a,e as O,s as F,r as xa,o as Sa,w as ta}from"../chunks/1d1SFneB.js";import{w as Y,aA as wa,aB as Ma,aC as ya,aD as $a,b as i,K as Ca,p as V,aE as ca,aF as va,l as Q,j as da,k as G,m as W,g as T,N as fa,Q as B,q as S,t as ua,Z as ga,n as w,o as M,a9 as ra}from"../chunks/sJ0mN3P5.js";import{p as ha,b as ka,s as J,a as X,i as Ia,c as b}from"../chunks/P627prjS.js";const sa=[...` 	
\r\f \v\uFEFF`];function Da(e,n,d){var c=""+e;if(d){for(var a in d)if(d[a])c=c?c+" "+a:a;else if(c.length)for(var r=a.length,l=0;(l=c.indexOf(a,l))>=0;){var f=l+r;(l===0||sa.includes(c[l-1]))&&(f===c.length||sa.includes(c[f]))?c=(l===0?"":c.substring(0,l))+c.substring(f+1):l=f}}return c===""?null:c}function Pa(e,n,d,c,a,r){var l=e.__className;if(Y||l!==d||l===void 0){var f=Da(d,c,r);(!Y||f!==e.getAttribute("class"))&&(f==null?e.removeAttribute("class"):e.className=f),e.__className=d}else if(r&&a!==r)for(var m in r){var $=!!r[m];(a==null||$!==!!a[m])&&e.classList.toggle(m,$)}return r}const za=Symbol("is custom element"),Na=Symbol("is html");function ia(e){if(Y){var n=!1,d=()=>{if(!n){if(n=!0,e.hasAttribute("value")){var c=e.value;na(e,"value",null),e.value=c}if(e.hasAttribute("checked")){var a=e.checked;na(e,"checked",null),e.checked=a}}};e.__on_r=d,wa(d),pa()}}function na(e,n,d,c){var a=Aa(e);Y&&(a[n]=e.getAttribute(n),n==="src"||n==="srcset"||n==="href"&&e.nodeName==="LINK")||a[n]!==(a[n]=d)&&(n==="loading"&&(e[Ma]=d),e.removeAttribute(n))}function Aa(e){return e.__attributes??={[za]:e.nodeName.includes("-"),[Na]:e.namespaceURI===ya}}function U(e,n,d=n){var c=$a();_a(e,"input",a=>{var r=a?e.defaultValue:e.value;if(r=H(e)?K(r):r,d(r),c&&r!==(r=n())){var l=e.selectionStart,f=e.selectionEnd;e.value=r??"",f!==null&&(e.selectionStart=l,e.selectionEnd=Math.min(f,e.value.length))}}),(Y&&e.defaultValue!==e.value||i(n)==null&&e.value)&&d(H(e)?K(e.value):e.value),Ca(()=>{var a=n();H(e)&&a===K(e.value)||e.type==="date"&&!a&&!e.value||a!==e.value&&(e.value=a??"")})}function H(e){var n=e.type;return n==="number"||n==="range"}function K(e){return e===""?null:+e}var Ta=Q('<canvas class="m-auto block h-[200px] w-[200px] bg-white" width="200" height="200"></canvas> <button>Redraw</button>',1);function Ea(e,n){V(n,!1);const[d,c]=J(),a=()=>X(r(),"$stickData",d);let r=ha(n,"stickData",8),l=fa();function f(_){if(!T(l))return;const s=T(l).getContext("2d");if(!s)return;const y=T(l).width,C=y/2,p=y/2,u=y/2*.9;s.clearRect(0,0,y,y),s.fillStyle="#9e9d9d",s.fillRect(C-u,p-u,u*2,u*2);const I=_.calibCurve.map((h,N)=>{const t=N*(360/_.calibCurve.length)*Math.PI/180,o=h/100*u;return{x:C+Math.cos(-t)*o,y:p+Math.sin(-t)*o}});I.forEach(h=>{s.beginPath(),s.arc(h.x,h.y,3,0,2*Math.PI),s.fillStyle=h===I[0]?"#f55":"#4366da",s.fill(),s.closePath()});const k=_.deadZone;s.setLineDash([]),s.fillStyle="rgba(100,100,100,0.3)",s.beginPath(),I.forEach((h,N)=>{const t=C+(h.x-C)*k,o=p+(h.y-p)*k;N===0?s.moveTo(t,o):s.lineTo(t,o)}),s.closePath(),s.fill(),s.strokeStyle="#f55",s.lineWidth=2;const D=_.gateSize*u;s.beginPath();for(let h=0;h<8;h++){const N=h*45*Math.PI/180,t=C+Math.cos(N)*D,o=p+Math.sin(N)*D;h===0?s.moveTo(t,o):s.lineTo(t,o)}s.closePath(),s.stroke();const P=_.rawX,z=_.rawY,g=Math.hypot(P,z),v=Math.atan2(z,P),L=C+Math.cos(v)*g*u,j=p+Math.sin(v)*g*u;s.fillStyle="#5f5",s.beginPath(),s.arc(L,j,5,0,2*Math.PI),s.fill();let A=Math.max(0,g-k)/(1-k);A=Math.min(A,1);const R=C+Math.cos(v)*A*D,q=p+Math.sin(v)*A*D;s.fillStyle="#f55",s.beginPath(),s.arc(R,q,5,0,2*Math.PI),s.fill()}ca(()=>(T(l),a()),()=>{T(l)&&f(a())}),va();var m=Ta(),$=da(m);ka($,_=>B(l,_),()=>T(l));var E=S($,2);O("click",E,()=>f(a())),G(e,m),W(),c()}var La=Q('<h3> </h3> <div><button><!></button></div> <label class="svelte-1bph924"> <input type="range" min="0" max="0.5" step="0.01" class="svelte-1bph924"/></label> <label class="svelte-1bph924"> <input type="range" min="0" max="1" step="0.0001" class="svelte-1bph924"/></label> <label class="svelte-1bph924">Calibration values: <textarea class="svelte-1bph924"></textarea></label> <button class="svelte-1bph924">Update</button> <!>',1);function la(e,n){V(n,!1);const[d,c]=J(),a=()=>X(r(),"$stickData",d);let r=ha(n,"stickData",8);function l(t,o=16){const x=Array(o).fill(0);for(const{x:Z,y:aa}of t){const ba=Math.hypot(Z,aa),ma=(Math.atan2(aa,Z)*180/Math.PI+360)%360,ea=Math.floor(ma/(360/o))%o;x[ea]=Math.max(x[ea],ba)}return x}function f(t){const o=(t[0]+t[4]+t[8]+t[12])/4;return o===0?t.map(()=>100):t.map(x=>(x/o*100).toFixed(2))}let m=!1;function $(t){const o=navigator.getGamepads()[t];if(o){const[x,Z]=[o.axes[a().axes[0]],o.axes[a().axes[1]]];b(r(),i(a).rawX=x,i(a)),b(r(),i(a).rawY=Z,i(a)),a().calibrating&&(a().samples.push({x,y:Z}),b(r(),i(a).calibCurve=f(l(a().samples,32)),i(a)),a().calibCurve.reverse(),b(r(),i(a).calibString=a().calibCurve.join(" "),i(a)))}requestAnimationFrame(()=>$(t))}const E=t=>{!m&&t>-1&&(console.log(`Starting gamepad polling for stick: ${a().id} at index ${t}`),m=!0,$(t))};function _(t){if(a().calibrating)return;const o=t.trim().split(/\s+/).map(x=>parseFloat(x)).filter(x=>!isNaN(x));o.length>2&&b(r(),i(a).calibCurve=o,i(a))}ca(()=>a(),()=>{E(a().gamepadIndex)}),va(),oa();var s=La(),y=da(s),C=w(y,!0);M(y);var p=S(y,2),u=w(p);let I;var k=w(u);{var D=t=>{var o=ra("⏹ Stop Calibration");G(t,o)},P=t=>{var o=ra("⏺ Start Calibration");G(t,o)};Ia(k,t=>{a(),i(()=>a().calibrating)?t(D):t(P,!1)})}M(u),M(p);var z=S(p,2),g=w(z),v=S(g);ia(v),M(z);var L=S(z,2),j=w(L),A=S(j);ia(A),M(L);var R=S(L,2),q=S(w(R));xa(q),M(R);var h=S(R,2),N=S(h,2);Ea(N,{get stickData(){return r()}}),ua((t,o,x)=>{F(C,(a(),i(()=>a().id))),I=Pa(u,1,"svelte-1bph924",null,I,t),F(g,`Dead Zone: ${o??""}% `),F(j,`Gate Size: ${x??""}% `)},[()=>({"bg-red-500":a().calibrating}),()=>(a(),i(()=>(a().deadZone*100).toFixed(0))),()=>(a(),i(()=>(a().gateSize*100).toFixed(2)))],ga),O("click",u,()=>{b(r(),i(a).calibrating=!a().calibrating,i(a)),a().calibrating&&b(r(),i(a).samples=[],i(a))}),U(v,()=>a().deadZone,t=>b(r(),i(a).deadZone=t,i(a))),U(A,()=>a().gateSize,t=>b(r(),i(a).gateSize=t,i(a))),U(q,()=>a().calibString,t=>b(r(),i(a).calibString=t,i(a))),O("click",h,()=>_(a().calibString)),G(e,s),W(),c()}var Ra=Q('<div class="p-[30px]"><div class="top svelte-tuzsit"><h1 class="svelte-tuzsit">Stick Calibration</h1> <div> </div></div> <div class="container svelte-tuzsit"><div class="stick-panel svelte-tuzsit"><!></div> <div class="stick-panel svelte-tuzsit"><!></div></div> <div class="mt-[10px] cursor-pointer bg-gray-300 p-[5px] font-mono whitespace-pre"> </div></div>');function qa(e,n){V(n,!1);const[d,c]=J(),a=()=>X(f,"$left",d),r=()=>X(m,"$right",d);let l=fa("");const f=ta({calibrating:!1,gamepadIndex:-1,id:"Main Stick",rawX:0,rawY:0,deadZone:.1,gateSize:.7937,calibCurve:[],calibString:"",samples:[],axes:[0,1]}),m=ta({calibrating:!1,gamepadIndex:-1,id:"C-Stick",rawX:0,rawY:0,deadZone:.1,gateSize:.7221,calibCurve:[],calibString:"",samples:[],axes:[2,3]});Sa(()=>{const g=navigator.getGamepads();for(let v=0;v<g.length;v++)if(g[v]){b(f,i(a).gamepadIndex=b(m,i(r).gamepadIndex=v,i(r)),i(a)),B(l,g[v].id);break}window.addEventListener("gamepadconnected",v=>{b(f,i(a).gamepadIndex=b(m,i(r).gamepadIndex=v.gamepad.index,i(r)),i(a)),B(l,v.gamepad.id)}),window.addEventListener("gamepaddisconnected",v=>{B(l,"No controller"),b(f,i(a).gamepadIndex=b(m,i(r).gamepadIndex=-1,i(r)),i(a))})});const $=g=>g.map(v=>[`${v.id}/Calibration = ${v.calibString}`,`${v.id}/Dead Zone = ${(v.deadZone*100).toFixed(2)}`,`${v.id}/Gate Size = ${(v.gateSize*100).toFixed(2)}`].join(`
`)).join(`
`),E=g=>{navigator.clipboard.writeText(g)};oa();var _=Ra(),s=w(_),y=S(w(s),2),C=w(y);M(y),M(s);var p=S(s,2),u=w(p),I=w(u);la(I,{get stickData(){return f}}),M(u);var k=S(u,2),D=w(k);la(D,{get stickData(){return m}}),M(k),M(p);var P=S(p,2),z=w(P,!0);M(P),M(_),ua(g=>{F(C,`Controller: ${T(l)??""}`),F(z,g)},[()=>$([a(),r()])],ga),O("click",P,()=>E($([a(),r()]))),G(e,_),W(),c()}export{qa as component};
